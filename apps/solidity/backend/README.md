# æ™ºèƒ½åˆçº¦æ•°æ®æœåŠ¡åç«¯

è¿™æ˜¯ä¸€ä¸ªåŸºäºKoa.jsçš„Node.jsåç«¯æœåŠ¡ï¼Œç”¨äºè¿æ¥ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦å¹¶æä¾›æ•°æ®APIæ¥å£ã€‚æ— éœ€å‰ç«¯è¿æ¥é’±åŒ…å³å¯è·å–åˆçº¦æ•°æ®ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- ğŸ”— è‡ªåŠ¨è¿æ¥Hardhatæœ¬åœ°ç½‘ç»œ
- ğŸ“Š è¯»å–Counterå’ŒGreetingåˆçº¦æ•°æ®
- ğŸ’¾ æ•°æ®æŒä¹…åŒ–å­˜å‚¨ä¸ºJSONæ–‡ä»¶
- ğŸ§ å®æ—¶ç›‘å¬åˆçº¦äº‹ä»¶
- â° å®šæ—¶åŒæ­¥åˆçº¦æ•°æ®
- ğŸŒ æä¾›RESTful APIæ¥å£
- ğŸ“ˆ äº‹ä»¶ç»Ÿè®¡å’Œç®¡ç†

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. ç¡®ä¿Hardhatç½‘ç»œè¿è¡Œ

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
npx hardhat node
```

### 3. ç¡®ä¿åˆçº¦å·²éƒ¨ç½²

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
npx hardhat ignition deploy ./ignition/modules/Counter.js --network localhost
npx hardhat ignition deploy ./ignition/modules/Greeting.js --network localhost
```

### 4. å¯åŠ¨åç«¯æœåŠ¡

```bash
npm start
# æˆ–è€…å¼€å‘æ¨¡å¼
npm run dev
```

æœåŠ¡å°†åœ¨ `http://localhost:3001` å¯åŠ¨

## ğŸ“¡ APIæ¥å£

### åˆçº¦æ•°æ®æ¥å£

- `GET /api/contracts` - è·å–æ‰€æœ‰åˆçº¦æ•°æ®ï¼ˆç¼“å­˜ï¼‰
- `GET /api/contracts/live` - è·å–å®æ—¶åˆçº¦æ•°æ®
- `GET /api/contracts/counter` - è·å–Counteråˆçº¦æ•°æ®
- `GET /api/contracts/greeting` - è·å–Greetingåˆçº¦æ•°æ®
- `POST /api/contracts/sync` - å¼ºåˆ¶åŒæ­¥åˆçº¦æ•°æ®
- `GET /api/contracts/status` - è·å–ç½‘ç»œå’Œåˆçº¦çŠ¶æ€

### äº‹ä»¶æ¥å£

- `GET /api/events` - è·å–æœ€è¿‘äº‹ä»¶ï¼ˆå¯æŒ‡å®šlimitå‚æ•°ï¼‰
- `GET /api/events/contract/:contractName` - è·å–æŒ‡å®šåˆçº¦çš„äº‹ä»¶
- `GET /api/events/stats` - è·å–äº‹ä»¶ç»Ÿè®¡ä¿¡æ¯
- `DELETE /api/events/cleanup?days=30` - æ¸…ç†æ—§äº‹ä»¶

### ç³»ç»Ÿæ¥å£

- `GET /` - APIæ–‡æ¡£é¦–é¡µ
- `GET /health` - å¥åº·æ£€æŸ¥

## ğŸ“Š æ•°æ®å­˜å‚¨

æ•°æ®å­˜å‚¨åœ¨ `backend/data/` ç›®å½•ï¼š

- `contracts.json` - åˆçº¦æ•°æ®ç¼“å­˜
- `events.json` - äº‹ä»¶è®°å½•

## ğŸ”§ é…ç½®

### åˆçº¦é…ç½®

ç¼–è¾‘ `config/contracts.js` æ–‡ä»¶æ¥é…ç½®åˆçº¦åœ°å€å’ŒABIï¼š

```javascript
module.exports = {
  network: {
    rpcUrl: "http://127.0.0.1:8545",
    chainId: 31337
  },
  contracts: {
    Counter: {
      address: "0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0",
      abi: [...]
    }
  }
};
```

### åŒæ­¥è®¾ç½®

æ•°æ®åŒæ­¥é—´éš”é»˜è®¤ä¸º30ç§’ï¼Œå¯åœ¨ `sync-contracts.js` ä¸­ä¿®æ”¹ï¼š

```javascript
this.syncInterval = 30000; // 30ç§’
```

## ğŸ”„ ä½¿ç”¨åœºæ™¯

### å‰ç«¯æ— é’±åŒ…è®¿é—®

å‰ç«¯å¯ä»¥ç›´æ¥è°ƒç”¨APIè·å–åˆçº¦æ•°æ®ï¼Œæ— éœ€è¿æ¥MetaMaskï¼š

```javascript
// è·å–Counteræ•°æ®
const response = await fetch('http://localhost:3001/api/contracts/counter');
const data = await response.json();
console.log('å½“å‰è®¡æ•°:', data.data.count);
```

### å®æ—¶äº‹ä»¶ç›‘æ§

åç«¯ä¼šè‡ªåŠ¨ç›‘å¬åˆçº¦äº‹ä»¶å¹¶è®°å½•ï¼Œå‰ç«¯å¯ä»¥æŸ¥è¯¢ï¼š

```javascript
// è·å–æœ€è¿‘çš„äº‹ä»¶
const events = await fetch('http://localhost:3001/api/events?limit=10');
```

## ğŸ› ï¸ å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
npm start

# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev

# ä»…è¿è¡ŒåŒæ­¥æœåŠ¡
npm run sync
```

## ğŸ“ˆ ç›‘æ§

è®¿é—® `/health` ç«¯ç‚¹å¯ä»¥æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š

- æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€
- ç½‘ç»œè¿æ¥çŠ¶æ€  
- æ•°æ®ç»Ÿè®¡ä¿¡æ¯
- åŒæ­¥æœåŠ¡çŠ¶æ€

## ğŸ” æ•…éšœæ’é™¤

### è¿æ¥å¤±è´¥

1. ç¡®ä¿Hardhatç½‘ç»œåœ¨è¿è¡Œ
2. æ£€æŸ¥ç«¯å£8545æ˜¯å¦è¢«å ç”¨
3. éªŒè¯åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®

### æ•°æ®ä¸åŒæ­¥

1. æ£€æŸ¥åˆçº¦æ˜¯å¦æ­£ç¡®éƒ¨ç½²
2. éªŒè¯åˆçº¦åœ°å€å’ŒABI
3. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ—¥å¿—

### äº‹ä»¶ç›‘å¬å¤±è´¥

1. ç¡®ä¿åˆçº¦äº‹ä»¶å®šä¹‰æ­£ç¡®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§
3. é‡å¯åç«¯æœåŠ¡

## ğŸ¯ æ‰©å±•åŠŸèƒ½

å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„åˆçº¦æ”¯æŒï¼š

1. åœ¨ `config/contracts.js` æ·»åŠ æ–°åˆçº¦é…ç½®
2. åœ¨ `contractService.js` æ·»åŠ è¯»å–æ–¹æ³•
3. åœ¨è·¯ç”±ä¸­æ·»åŠ æ–°çš„APIç«¯ç‚¹
4. æ›´æ–°äº‹ä»¶ç›‘å¬å™¨

## ğŸ“ æ—¥å¿—

æœåŠ¡ä¼šè¾“å‡ºè¯¦ç»†çš„è¿è¡Œæ—¥å¿—ï¼š

- âœ… æˆåŠŸæ“ä½œ
- âŒ é”™è¯¯ä¿¡æ¯  
- ğŸ”„ åŒæ­¥çŠ¶æ€
- ğŸ“¡ äº‹ä»¶ç›‘å¬
- ğŸš€ æœåŠ¡çŠ¶æ€ 